<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AR.js Prueba con botón</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
    <style>
      body, html { margin: 0; padding: 0; overflow: hidden; }
      #startAR {
        position: fixed;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
        padding: 10px 20px;
        background-color: #2196f3;
        color: white;
        border: none;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
      }
      #log {
        position: fixed;
        bottom: 10px;
        left: 10px;
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 8px 14px;
        border-radius: 6px;
        font-family: monospace;
        font-size: 14px;
        z-index: 20;
      }
    </style>
  </head>
  <body>

    <button id="startAR">Obtener mi ubicación y mostrar objeto AR</button>
    <div id="log">Esperando clic...</div>

    <a-scene
      embedded
      arjs="sourceType: webcam; gpsMinAccuracy: 100; gpsTimeInterval: 1000;"
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;"
    >
      <a-camera gps-new-camera rotation-reader></a-camera>
    </a-scene>

    <script>
      const log = (msg) => document.getElementById('log').textContent = msg;

      document.getElementById('startAR').addEventListener('click', () => {
        log("Obteniendo ubicación...");

        if (!navigator.geolocation) {
          log("Tu navegador no soporta geolocalización.");
          return;
        }

        navigator.geolocation.getCurrentPosition(
          (position) => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            log(`Ubicación obtenida: ${lat.toFixed(5)}, ${lng.toFixed(5)}`);

            const entity = document.createElement('a-entity');
            entity.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lng}`);
            entity.setAttribute('look-at', '[gps-new-camera]');

            const box = document.createElement('a-box');
            box.setAttribute('color', 'blue');
            box.setAttribute('depth', '5');
            box.setAttribute('height', '5');
            box.setAttribute('width', '5');
            box.setAttribute('position', '0 5 0');

            const text = document.createElement('a-text');
            text.setAttribute('value', '¡Aquí estás!');
            text.setAttribute('scale', '20 20 20');
            text.setAttribute('color', 'white');
            text.setAttribute('position', '0 12 0');

            entity.appendChild(box);
            entity.appendChild(text);

            document.querySelector('a-scene').appendChild(entity);
          },
          (error) => {
            log("Error obteniendo ubicación: " + error.message);
          },
          {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 0
          }
        );
      });
    </script>

  </body>
</html>
